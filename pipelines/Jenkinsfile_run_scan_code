pipeline {
    agent any
    stages {
        stage('Run Serenity Suite') {
            steps {
                script {
                    echo "Run all Tests of suite in Serenity"
                    build(
                        job: 'Run-Suite-YourStore-SerenityBdd-Screenplay-TestLab',
                        parameters: [
                            string(name: 'SUITE', value: 'AllTestRunner'),
                            string(name: 'BROWSER', value: 'Chrome')
                        ]
                    )
                }
            }
        }
        stage('Run SonarQube Scan') {
            steps {
                script {
                    def currentDir = pwd()
                    echo "Run SonarQube scan in: ${currentDir}"
                    build(
                        job: 'scan-code',
                        parameters: [
                            string(name: 'REPO_DIR', value: currentDir)
                        ]
                    )
                }
            }
        }
    }
}