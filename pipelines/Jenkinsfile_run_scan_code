pipeline {
    agent any

    environment {
            WORKSPACE_PATH = "/var/jenkins_home/workspace/"
        }

    stages {
        stage('Run Serenity Suite') {
            steps {
                script {
                    echo "Run all Tests of suite in Serenity"
                    catchError(buildResult: 'SUCCESS', stageResult: 'SUCCESS') {
                        build(
                            job: 'Run-Suite-YourStore-SerenityBdd-Screenplay-TestLab',
                            parameters: [
                                string(name: 'SUITE', value: 'AllTestRunner'),
                                string(name: 'BROWSER', value: 'Chrome')
                            ]
                        )
                    }
                }
            }
        }

        stage('Run SonarQube Scan') {
            steps {
                script {
                    def currentDir = "${WORKSPACE_PATH}/Run-Suite-YourStore-SerenityBdd-Screenplay-TestLab"
                    dir(currentDir){
                        echo "Run SonarQube scan in: ${currentDir} where the tests have executed."
                        build(
                            job: 'scan-code',
                            parameters: [
                                string(name: 'REPO_DIR', value: currentDir)
                        ])
                    }
                }
            }
        }
    }
}
